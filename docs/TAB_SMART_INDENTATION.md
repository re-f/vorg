# TAB 键智能折叠功能

VOrg 扩展现在支持类似 Emacs org-mode 的 TAB 键智能折叠功能，主要用于控制可见性（visibility cycling）。

## 功能概述

TAB 键的行为会根据光标所在位置的上下文自动调整，**主要功能是切换折叠/展开状态**：

- **标题上下文**：切换标题的折叠/展开状态
- **列表项上下文**：切换列表项的折叠/展开状态（如有子项），否则增加缩进
- **任务列表上下文**：切换任务列表的折叠/展开状态（如有子项），否则增加缩进
- **代码块标题上下文**：切换代码块的折叠/展开状态
- **表格上下文**：移动到下一个单元格
- **代码块内部**：执行正常的代码缩进
- **普通文本**：执行正常的文本缩进

## 快捷键

| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 智能 TAB | `Tab` | 主要用于切换折叠/展开状态，或执行上下文相关操作 |
| 智能 Shift+TAB | `Shift+Tab` | 在列表中减少缩进，在表格中反向导航 |

## 详细行为说明

### 1. 在标题上使用 TAB - 折叠切换

当光标位于标题行时，TAB 键会切换该标题的折叠状态：

```org
* 这是一个标题          <- 光标在这里按 TAB
  - 子内容 1
  - 子内容 2
** 子标题
   一些内容
```

按 TAB 后，标题内容会被折叠或展开。

### 2. 在列表项上使用 TAB - 智能折叠或缩进

在列表项上按 TAB 的行为取决于是否有子项：

#### 有子项的列表 - 折叠切换
```org
- 主要话题              <- 光标在这里按 TAB 会切换折叠状态
  - 子话题 1
  - 子话题 2
    - 详细内容
```

#### 没有子项的列表 - 增加缩进
```org
- 单独列表项            <- 光标在这里按 TAB 会增加缩进
```

变为：

```org
  - 单独列表项          <- 缩进增加了 2 个空格
```

#### Shift+TAB - 减少缩进

按 Shift+TAB 会减少缩进级别：

```org
    - 三级列表项        <- 光标在这里按 Shift+TAB
```

变为：

```org
  - 三级列表项          <- 缩进减少了 2 个空格
```

### 3. 在任务列表上使用 TAB - 智能折叠或缩进

任务列表（复选框列表）的行为与普通列表相同：

#### 有子项的任务列表 - 折叠切换
```org
- [ ] 主要任务          <- 按 TAB 切换折叠状态
  - [ ] 子任务 1
  - [X] 子任务 2
```

#### 没有子项的任务列表 - 增加缩进
```org
- [ ] 独立任务          <- 按 TAB 增加缩进
```

### 4. 在代码块标题上使用 TAB - 折叠切换

在代码块的开始标签上按 TAB 会切换代码块的折叠状态：

```org
#+BEGIN_SRC python      <- 光标在这里按 TAB 会折叠/展开代码块
def hello():
    print("Hello World")
#+END_SRC
```

### 5. 在表格中使用 TAB - 单元格导航

在表格中，TAB 键用于在单元格之间导航：

```org
| 列1 | 列2 | 列3 |
|-----|-----|-----|
| A   | B   | C   |     <- 光标在 A 处按 TAB，移动到 B
| D   | E   | F   |
```

#### 表格导航规则

- **TAB**：移动到下一个单元格
- **Shift+TAB**：移动到上一个单元格
- 到达行末时，自动移动到下一行的第一个单元格
- 在第一个单元格按 Shift+TAB 时，移动到上一行的最后一个单元格

### 6. 在代码块内部使用 TAB - 正常缩进

在代码块内，TAB 键保持正常的代码缩进行为：

```org
#+BEGIN_SRC python
def hello():
    print("hello")      <- 正常的代码缩进
#+END_SRC
```

### 7. 在普通文本中使用 TAB - 正常缩进

在普通文本中，TAB 键执行标准的文本缩进操作。

## 与 Emacs org-mode 的兼容性

这个实现精确模拟了 Emacs org-mode 中 TAB 键的行为：

| 上下文 | Emacs org-mode | VOrg 扩展 | 兼容性 |
|--------|----------------|-----------|--------|
| 标题 | 折叠/展开切换 | 折叠/展开切换 | ✅ 完全兼容 |
| 列表（有子项） | 折叠/展开切换 | 折叠/展开切换 | ✅ 完全兼容 |
| 列表（无子项） | 增加缩进 | 增加缩进 | ✅ 完全兼容 |
| 代码块标题 | 折叠/展开切换 | 折叠/展开切换 | ✅ 完全兼容 |
| 表格 | 单元格导航 | 单元格导航 | ✅ 完全兼容 |

## 使用技巧

### 文档结构管理

使用 TAB 键可以有效管理文档的可见性：

```org
* 第一章                <- 按 TAB 折叠整章
  一些介绍内容
** 1.1 节
   详细内容
** 1.2 节
   更多内容

* 第二章                <- 按 TAB 折叠整章
  - 要点 1              <- 按 TAB 折叠子要点
    - 详细说明 1
    - 详细说明 2
  - 要点 2
    - 详细说明 3
```

### 代码块管理

在长文档中，可以折叠不相关的代码块：

```org
#+BEGIN_SRC python      <- 按 TAB 折叠代码块
def complex_function():
    # 很长的代码实现
    pass
#+END_SRC

#+BEGIN_SRC javascript  <- 按 TAB 折叠代码块
function anotherFunction() {
    // 更多代码
}
#+END_SRC
```

### 任务管理

对于复杂的任务列表，可以折叠已完成的部分：

```org
- [X] 已完成的主要任务  <- 按 TAB 折叠已完成的子任务
  - [X] 子任务 1
  - [X] 子任务 2
  - [X] 子任务 3

- [ ] 进行中的任务      <- 按 TAB 折叠/展开查看进度
  - [X] 已完成部分
  - [ ] 待办部分
```

## 注意事项

1. **主要功能**：TAB 键在 org-mode 中主要用于**可见性控制**，而不是缩进
2. **智能判断**：系统会自动判断列表项是否有子项来决定是折叠还是缩进
3. **作用域限制**：智能 TAB 功能仅在 `.org` 文件中生效
4. **备用缩进**：Shift+TAB 在列表中提供缩进调整功能
