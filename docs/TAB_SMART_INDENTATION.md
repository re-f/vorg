# TAB 键智能功能

VOrg 扩展的 TAB 键采用智能行为：保持与标准编辑器的一致性（插入TAB字符、选中文字缩进），同时为org-mode结构（标题、列表等）提供折叠/展开功能。

## 功能概述

TAB 键的行为会根据光标所在位置的上下文和是否有文字被选中自动调整：

**当有文字被选中时**：
- **TAB键**：对所有选中的行执行缩进操作
- **Shift+TAB键**：对所有选中的行执行反向缩进操作

**当没有文字被选中时**：
- **标题上下文**：切换标题的折叠/展开状态
- **列表项上下文**：智能判断 - 有子项时折叠/展开，无子项时插入TAB字符
- **任务列表上下文**：智能判断 - 有子项时折叠/展开，无子项时插入TAB字符
- **代码块标题上下文**：切换代码块的折叠/展开状态
- **表格上下文**：移动到下一个单元格
- **代码块内部**：插入TAB字符（正常编辑器行为）
- **普通文本**：插入TAB字符（正常编辑器行为）

## 快捷键

| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 智能 TAB | `Tab` | 选中文字时缩进；未选中时根据上下文折叠或插入TAB字符 |
| 智能 Shift+TAB | `Shift+Tab` | 选中文字时反向缩进；未选中时执行默认行为 |


### 1. 在标题上使用 TAB - 折叠切换

当光标位于标题行时，TAB 键会切换该标题的折叠状态：

```org
* 这是一个标题          <- 光标在这里按 TAB
  - 子内容 1
  - 子内容 2
** 子标题
   一些内容
```

按 TAB 后，标题内容会被折叠或展开。

### 2. 在列表项上使用 TAB - 智能折叠或插入TAB

在列表项上按 TAB 键的行为会根据是否有子项智能判断：

#### 有子项的列表 - 折叠/展开切换
```org
- 主要话题              <- 光标在这里按 TAB 会切换折叠状态
  - 子话题 1
  - 子话题 2
    - 详细内容
```


#### 没有子项的列表 - 插入TAB字符
```org
- const value = 10;     <- 光标在 = 号位置按 TAB
```

按 TAB 后会在光标位置插入TAB字符（或空格，根据编辑器设置）：

```org
- const value   = 10;   <- 在光标位置插入了TAB字符
```

#### 整行缩进 - 需要选中文字
如果想要对列表项进行整行缩进，需要**先选中文字**：

```org
- 列表项 1              <- 选中这些行
- 列表项 2
- 列表项 3
```

选中后按 TAB：

```org
    - 列表项 1          <- 所有选中行都增加了缩进
    - 列表项 2
    - 列表项 3
```


#### Shift+TAB - 反向缩进（需选中文字）

和TAB键一样，Shift+TAB 的整行缩进功能也需要先选中文字：

```org
    - 三级列表项 1      <- 选中这些行
    - 三级列表项 2
```

选中后按 Shift+TAB：

```org
  - 三级列表项 1        <- 所有选中行的缩进都减少了 2 个空格
  - 三级列表项 2
```

如果没有选中文字，Shift+TAB 会执行编辑器的默认行为（通常是反向TAB或outdent）。

### 3. 在任务列表上使用 TAB - 智能折叠或插入TAB

任务列表（复选框列表）的行为与普通列表完全相同，智能判断是否有子项：

#### 有子项的任务列表 - 折叠/展开切换
```org
- [ ] 主要任务          <- 按 TAB 切换折叠状态
  - [ ] 子任务 1
  - [X] 子任务 2
```

按 TAB 后会折叠或展开子任务，光标位置保持不变。

#### 没有子项的任务列表 - 插入TAB字符
```org
- [ ] 独立任务 description  <- 按 TAB 在光标位置插入TAB字符
```

和普通列表一样，如需整行缩进请先选中文字。

### 4. 在代码块标题上使用 TAB - 折叠切换

在代码块的开始标签上按 TAB 会切换代码块的折叠状态：

```org
#+BEGIN_SRC python      <- 光标在这里按 TAB 会折叠/展开代码块
def hello():
    print("Hello World")
#+END_SRC
```

### 5. 在表格中使用 TAB - 单元格导航

在表格中，TAB 键用于在单元格之间导航：

```org
| 列1 | 列2 | 列3 |
|-----|-----|-----|
| A   | B   | C   |     <- 光标在 A 处按 TAB，移动到 B
| D   | E   | F   |
```

#### 表格导航规则

- **TAB**：移动到下一个单元格
- **Shift+TAB**：移动到上一个单元格
- 到达行末时，自动移动到下一行的第一个单元格
- 在第一个单元格按 Shift+TAB 时，移动到上一行的最后一个单元格

### 6. 在代码块内部使用 TAB - 正常缩进

在代码块内，TAB 键保持正常的代码缩进行为：

```org
#+BEGIN_SRC python
def hello():
    print("hello")      <- 正常的代码缩进
#+END_SRC
```

### 7. 在普通文本中使用 TAB - 正常缩进

在普通文本中，TAB 键执行标准的文本缩进操作。

## TAB 键行为对照表

这个实现采用符合现代编辑器习惯的 TAB 键行为，并为org-mode结构提供增强功能：

| 上下文 | 标准编辑器行为 | VOrg 扩展 | 状态 |
|--------|--------------|-----------|------|
| **有文字被选中** | 缩进选中的行 | 缩进选中的行 | ✅ 符合标准 |
| 标题（无选中） | 插入TAB字符 | 折叠/展开切换，保持光标 | ℹ️ 增强功能 |
| **列表项（有子项，无选中）** | 插入TAB字符 | **折叠/展开切换，保持光标** | **ℹ️ 增强功能** |
| **列表项（无子项，无选中）** | 插入TAB字符 | **插入TAB字符** | **✅ 符合标准** |
| 任务列表（有子项，无选中） | 插入TAB字符 | 折叠/展开切换，保持光标 | ℹ️ 增强功能 |
| 任务列表（无子项，无选中） | 插入TAB字符 | 插入TAB字符 | ✅ 符合标准 |
| 代码块标题（无选中） | 插入TAB字符 | 折叠/展开切换，保持光标 | ℹ️ 增强功能 |
| 表格（无选中） | 插入TAB字符 | 单元格导航 | ℹ️ 增强功能 |

## 使用技巧

### 文档结构管理

使用 TAB 键可以有效管理文档的可见性：

```org
* 第一章                <- 按 TAB 折叠整章
  一些介绍内容
** 1.1 节
   详细内容
** 1.2 节
   更多内容

* 第二章                <- 按 TAB 折叠整章
  - 要点 1              <- 按 TAB 折叠子要点
    - 详细说明 1
    - 详细说明 2
  - 要点 2
    - 详细说明 3
```

### 代码块管理

在长文档中，可以折叠不相关的代码块：

```org
#+BEGIN_SRC python      <- 按 TAB 折叠代码块
def complex_function():
    # 很长的代码实现
    pass
#+END_SRC

#+BEGIN_SRC javascript  <- 按 TAB 折叠代码块
function anotherFunction() {
    // 更多代码
}
#+END_SRC
```

### 任务管理

对于复杂的任务列表，可以折叠已完成的部分：

```org
- [X] 已完成的主要任务  <- 按 TAB 折叠已完成的子任务
  - [X] 子任务 1
  - [X] 子任务 2
  - [X] 子任务 3

- [ ] 进行中的任务      <- 按 TAB 折叠/展开查看进度
  - [X] 已完成部分
  - [ ] 待办部分
```

## 注意事项

1. **主要功能**：TAB 键在 org-mode 中主要用于**可见性控制**，而不是缩进
2. **智能判断**：系统会自动判断列表项是否有子项来决定是折叠还是缩进
3. **作用域限制**：智能 TAB 功能仅在 `.org` 文件中生效
4. **备用缩进**：Shift+TAB 在列表中提供缩进调整功能
