# VOrg 语法高亮功能

VOrg 扩展提供了完整的 Org-mode 语法高亮功能，包括 TextMate 语法定义和额外的装饰器高亮。**语法高亮会自动跟随 VS Code 的当前主题**，为深色和浅色主题提供最佳的视觉体验。

## 功能特性

### 基础语法高亮（TextMate 语法）

VOrg 使用 TextMate 语法定义 (`org.tmLanguage.json`) 提供基础的语法高亮，支持：

#### 标题层级
- **1-6 级标题**：不同颜色和字体加粗
- **TODO 状态**：TODO、DONE、NEXT、WAITING、CANCELLED
- **标签支持**：标题后的 `:tag1:tag2:` 格式

#### 文本格式
- **粗体**：`*粗体*`
- **斜体**：`/斜体/`
- **下划线**：`_下划线_`
- **删除线**：`+删除线+`
- **代码**：`=代码=` 和 `~等宽字体~`

#### 列表
- **无序列表**：`-`、`+`、`*` 开头
- **有序列表**：数字和字母编号
- **任务列表**：`[ ]`、`[X]`、`[-]` 复选框

#### 代码块
- **语言标识**：`#+BEGIN_SRC language`
- **参数支持**：`#+BEGIN_SRC python -n -r`
- **语法高亮**：根据语言类型

#### 其他语法元素
- **链接**：内部链接、外部链接、裸链接
- **引用块**：`#+BEGIN_QUOTE`
- **示例块**：`#+BEGIN_EXAMPLE`
- **表格**：完整的表格语法支持
- **数学公式**：行内 `$...$` 和块级 `$$...$$`
- **时间戳**：各种时间格式
- **关键字**：文档属性和特殊关键字
- **注释**：以 `#` 开头的注释行
- **水平分隔线**：`-----`

### 增强装饰器高亮

除了基础语法高亮，VOrg 还提供了额外的装饰器高亮，**颜色会根据 VS Code 主题自动调整**：

#### TODO 状态高亮
- **TODO/NEXT/WAITING**：红色系背景高亮
- **DONE/CANCELLED**：绿色系背景高亮

#### 标签高亮
- **彩色标签**：紫色系背景，圆角边框
- **斜体样式**：更好的视觉区分

#### 时间戳高亮
- **背景色**：绿色系背景
- **圆角边框**：现代化外观

#### 链接高亮
- **下划线**：可点击的视觉提示
- **蓝色字体**：标准链接颜色

#### 代码块高亮
- **背景色**：主题适应的背景色
- **左边框**：橙色系边框标识
- **圆角边框**：现代化外观

#### 引用块高亮
- **背景色**：绿色系背景
- **左边框**：绿色系边框标识
- **斜体样式**：引用文本样式

#### 表格高亮
- **背景色**：黄色系背景
- **行高亮**：整行高亮显示

#### 数学公式高亮
- **背景色**：紫色系背景
- **圆角边框**：公式块标识

## 主题自适应

VOrg 的语法高亮会**自动检测并跟随 VS Code 的当前主题**：

### 深色主题适配
- 当使用深色主题时，使用适合深色背景的颜色方案
- 高对比度，护眼的深色背景
- 自动适应 Dark、Dark+ 等深色主题

### 浅色主题适配
- 当使用浅色主题时，使用适合浅色背景的颜色方案
- 明亮清晰的颜色方案
- 自动适应 Light、Light+ 等浅色主题

### 实时主题切换
- **无缝切换**：当您切换 VS Code 主题时，语法高亮会立即更新
- **自动检测**：无需手动配置，自动识别主题类型
- **全局同步**：所有打开的 .org 文件都会同步更新

## 使用方法

### 启用语法高亮

1. **自动启用**：打开 `.org` 文件时自动启用
2. **实时更新**：编辑时自动更新高亮
3. **主题同步**：切换 VS Code 主题时自动更新颜色

### 主题切换体验

1. 打开任何 `.org` 文件
2. 使用 `Ctrl+Shift+P` → "Preferences: Color Theme"
3. 选择任何深色或浅色主题
4. 语法高亮会立即适应新主题！

### 自定义颜色（高级用户）

如需自定义特定颜色，可以在 `settings.json` 中添加：

```json
{
  "editor.tokenColorCustomizations": {
    "textMateRules": [
      {
        "scope": "markup.heading.1.org",
        "settings": {
          "foreground": "#your-custom-color"
        }
      }
    ]
  }
}
```

## 技术实现

### 主题检测机制
- **API**：使用 `vscode.window.activeColorTheme.kind`
- **监听器**：`onDidChangeActiveColorTheme` 事件监听
- **实时更新**：主题变化时立即重新渲染

### 颜色自适应算法
- **深色主题**：使用高亮度、低饱和度颜色
- **浅色主题**：使用中等亮度、高饱和度颜色
- **对比度优化**：确保在不同主题下都有良好的可读性

### TextMate 语法定义
- **文件**：`syntaxes/org.tmLanguage.json`
- **作用域**：`source.org`
- **语法规则**：正则表达式匹配

### 装饰器高亮
- **文件**：`src/syntaxHighlighter.ts`
- **API**：VS Code Decoration API
- **动态颜色**：根据主题类型动态生成颜色

## 性能优化

### 主题变化优化
- **智能检测**：只在主题真正变化时更新
- **批量更新**：同时更新所有打开的编辑器
- **资源管理**：正确清理和重建装饰器

### 防抖机制
- 避免频繁的语法高亮更新
- 100ms 延迟的防抖处理

### 内存管理
- 单例模式的语法高亮器
- 正确的资源清理和释放

## 支持的主题类型

### 深色主题
- Dark (default dark)
- Dark+
- Monokai
- Dracula
- 以及其他深色主题

### 浅色主题
- Light (default light)
- Light+
- Quiet Light
- Solarized Light
- 以及其他浅色主题

### 高对比度主题
- 自动识别高对比度主题
- 提供更高的颜色对比度

## 故障排除

### 语法高亮不工作
1. 确认文件扩展名为 `.org`
2. 检查语言模式是否为 "Org"
3. 重新加载 VS Code 窗口

### 主题切换不生效
1. 尝试重新打开 .org 文件
2. 检查是否与其他扩展冲突
3. 重启 VS Code

### 颜色显示异常
1. 确认使用的是标准 VS Code 主题
2. 检查是否有自定义的颜色配置冲突
3. 重置用户设置中的颜色自定义

## 扩展性

### 自定义主题适配
可以通过修改 `getThemeColors()` 方法添加对特殊主题的支持。

### 颜色方案扩展
可以为特定主题类型定义专门的颜色方案。

### 主题检测增强
可以添加对更多主题类型的检测和适配。

---

VOrg 的智能主题跟随功能让您在任何 VS Code 主题下都能获得最佳的 Org-mode 编辑体验！🎨 