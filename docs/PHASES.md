# VOrg 开发阶段 (Phase) 记录

本文档记录 VOrg 扩展的主要开发阶段和里程碑。

## Phase 0: 结构化存储基础设施 (进行中)

**目标**: 实现基于 SQLite 的结构化存储系统,为 Agenda、搜索、反向链接等功能提供高性能数据层。

**时间**: 2026-01-28 开始,预计 3-4 周

**参考架构**: org-roam (Emacs Org-mode 知识管理系统)

### Stage 1: 数据库层基础 (3-4 天) ✅ 已完成

#### ✅ Stage 1.1: 项目依赖配置 (已完成 2026-01-28)
- 技术选型: better-sqlite3 vs sql.js
- 安装 better-sqlite3@12.6.2
- 配置 webpack 处理 native 模块
- 文档: `docs/TECHNICAL_DECISIONS.md`

#### ✅ Stage 1.2: 数据模型定义 (已完成 2026-01-28)
- TypeScript 类型定义 (250+ 行)
- 单元测试: 17/17 通过

#### ✅ Stage 1.3: 数据库 Schema 设计 (已完成 2026-01-28)
- SQL Schema (200+ 行): 5 表, 15+ 索引, 3 视图
- SchemaManager 类 (220+ 行)
- 单元测试: 17/17 通过

#### ✅ Stage 1.4: 数据库连接管理 (已完成 2026-01-28)
- DatabaseConnection 单例模式 (280+ 行)
- 事务支持、备份恢复
- 单元测试: 19/19 通过

#### ✅ Stage 1.5: 基础 CRUD 操作 (已完成 2026-01-28)
- FileRepository 类 (180+ 行)
- 完整 CRUD 操作
- 单元测试: 18/18 通过

**Stage 1 总结**:
- 代码: ~1200+ 行
- 测试: 71/71 通过
- 完成日期: 2026-01-28
- Commits: 3 个

### Stage 2: 文件解析与索引 (4-5 天) 🔄 进行中
- ✅ HeadingRepository 实现 (19 tests)
- ✅ LinkRepository 实现 (17 tests)
- ✅ UniorgAstExtractor 实现 (22 tests)
- 🔄 FileIndexer 实现
- 批量索引工作区
- 性能优化

### Stage 3: 增量更新机制 (3-4 天)
- 文件监听器
- 变更检测
- 差异更新
- 错误恢复

### Stage 4: 查询 API (3-4 天)
- 基础查询
- Agenda 查询
- 标签查询
- 链接查询
- 复杂过滤

### Stage 5: 集成与测试 (2-3 天)
- 服务层封装
- VS Code 集成
- 命令实现
- 端到端测试

**验收标准**:
- ✅ 所有单元测试通过 (131/131 tests)
- ✅ 所有集成测试通过 (36/36 tests, 手工验证)
- ⏳ E2E 测试通过
- ⏳ 性能指标达标:
  - 索引 100 文件 < 5 秒
  - 单次查询 < 50ms
  - 增量更新 < 100ms

---

## Phase 1: 编辑增强 (计划中)

**目标**: 实现高级编辑功能,提升日常使用效率

**预计时间**: 2-3 周

### 功能列表
- 列表项移动/缩进 (高优先级)
- 子树移动 (`org-metaup/down`) (中优先级)
- Refile 功能 (中优先级)

---

## Phase 2: TODO 与时间管理 (计划中)

**目标**: 完整的任务管理功能

**预计时间**: 2-3 周

### 功能列表
- 优先级与标签系统
- SCHEDULED/DEADLINE 日期
- 标签搜索
- 重复任务 (低优先级)

---

## Phase 3: 现代化 Agenda 视图 (计划中)

**目标**: 打造现代化的任务总览界面

**预计时间**: 3-4 周

### 功能列表
- Webview UI 设计
- 多视图模式 (日历、看板、时间线、列表)
- 拖拽交互
- 实时过滤

---

## Phase 4+: 其他功能 (计划中)

### 中优先级
- 快速捕获
- 归档功能

### 低优先级
- Markdown 导出
- 表格编辑
- Sparse Tree 搜索
- 其他高级功能

---

## 里程碑

- **v0.1.0**: Phase 0 完成 - 结构化存储就绪
- **v0.2.0**: Phase 2 完成 - 任务管理完善
- **v0.3.0**: Phase 3 完成 - Agenda 上线
- **v1.0.0**: 所有高/中优先级功能完成 (目标: 2026 年中)

---

## 更新日志

- 2026-01-28: Phase 0 启动
  - Stage 1.1-1.3 完成 (依赖、类型、Schema)
  - Stage 1.4 完成 (数据库连接管理)
  - Stage 1.5 完成 (File Repository)
  - **Stage 1 完成** ✅ (71/71 测试通过)
